<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jmframework.boot.jmspringbootstarter.mapper.UserMapper">
    <select id="findByUsernameOrEmailOrPhone"
            resultType="com.jmframework.boot.jmspringbootstarter.domain.persistence.UserPO">
        SELECT tu.id,
               tu.username,
               tu.email,
               tu.cellphone    AS cellphone,
               tu.password,
               tu.full_name    AS fullName,
               tu.birthday,
               tu.gender,
               tu.gmt_created  AS gmtCreated,
               tu.gmt_modified AS gmtModified,
               tu.status
        FROM t_user tu
        <where>
            <if test="username != null">
                tu.username = #{username}
            </if>
            <if test="email != null">
                or tu.email = #{email}
            </if>
            <if test="phone != null">
                or tu.cellphone = #{phone}
            </if>
        </where>
    </select>

    <select id="checkUsernameUniqueness" resultType="integer">
        SELECT count(1)
        FROM t_user tu
        WHERE tu.username = #{username}
    </select>

    <select id="checkEmailUniqueness" resultType="integer">
        SELECT count(1)
        FROM t_user tu
        WHERE tu.email = #{email}
    </select>

    <insert id="save" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_user(username,
                           email,
                           cellphone,
                           password,
                           full_name,
                           birthday,
                           gender,
                           gmt_modified,
                           gmt_created,
                           status)
        VALUES (#{username},
                #{password},
                #{cellphone},
                #{password},
                #{fullName},
                #{birthday},
                #{gender},
                now(),
                now(),
                #{status})
    </insert>

    <insert id="register" useGeneratedKeys="true" keyProperty="id">
        INSERT INTO t_user(username, password, email, gmt_created, gmt_modified, status)
        VALUES (#{username}, #{password}, #{email}, now(), now(), 1)
    </insert>

    <select id="getUsernameCountByUsername" resultType="integer">
        SELECT count(1)
        FROM t_user tu
        WHERE tu.username = #{username}
    </select>

    <select id="getAllUser" resultType="com.jmframework.boot.jmspringbootstarter.domain.persistence.UserPO">
        SELECT tu.id,
               tu.username,
               tu.email,
               tu.cellphone    AS cellphone,
               tu.password,
               tu.full_name    AS fullName,
               tu.birthday,
               tu.gender,
               tu.gmt_created  AS gmtCreated,
               tu.gmt_modified AS gmtModified,
               tu.status
        FROM t_user tu
    </select>
</mapper>
